
# Лабораторная работа №3

---

**Выполнил:** Маликов Александр Максимович, 368475 

**Группа:** P3322

---

# Цель:

Получить навыки работы с вводом/выводом, потоковой обработкой данных, командной строкой.

---

## Требования к разработанному ПО:

1. обязательно должна быть реализована линейная интерполяция;
2. настройки алгоритма интерполяции и выводимых данных должны задаваться через аргументы командной строки:
    - какие алгоритмы использовать (в том числе два сразу);
    - частота дискретизации результирующих данных;
    - и т.п.;

3. входные данные должны задаваться в текстовом формате на подобии ".csv" (к примеру x;y\n или x\ty\n) и подаваться на стандартный ввод, входные данные должны быть отсортированы по возрастанию x;
4. выходные данные должны подаваться на стандартный вывод;
5. программа должна работать в потоковом режиме (пример -- cat | grep 11), это значит, что при запуске программы она должна ожидать получения данных на стандартный ввод, и, по мере получения достаточного количества данных, должна выводить рассчитанные точки в стандартный вывод;

## Реализация

### Функция запроса ввода пользователя

В функции main происходит обработка параметров, введенных при старте программы, также присутствует функция-обработчик вводимых пользователем точек (используется далее в `process-data`)

```clojure
(defn -main [& args]
      (let [{:keys [options]} (parse-cli-args args)]
           (if (:help options)
             (println "Использование: \n  -s  Шаг интерполяции \n  -m  Метод интерполяции (linear, lagrange, both) \n  -w  Размер окна для Лагранжа")
             (let [step-size (or (:step options) 1.0)
                   method (or (:method options) "both")
                   window-size (Integer/parseInt (or (:window options) "5"))]
                  (println "Введите данные в формате X Y")
                  (process-data step-size method window-size)))))

(defn parse-point [input]
      (let [[x y] (str/split input #"[ \t,;]+")]
           [(Double/parseDouble x) (Double/parseDouble y)]))

```
### Функция для обработки элементов командной строки
Предназначена для описания и обработки параметров командной строки в приложении.
```clojure
(def cli-options
  [["-s" "--step STEP" "Шаг для интерполяции" :parse-fn #(Double/parseDouble %)]
   ["-m" "--method METHOD" "Метод интерполяции (линейный, лагранж, оба)"
    :validate [#{"linear" "lagrange" "both"} "Укажите 'linear', 'lagrange' или 'both'"]]
   ["-w" "--window WINDOW" "размер окна для вычисления интерполяционного многочлена Лагранжа"]
   ["-h" "--help"]])

(defn parse-cli-args [args]
      (parse-opts args cli-options))
```

## Реализация алгоритмов интерполяции

---

### Линейная интерполяция

```clojure
(defn interpolate-linear [data step-size]
      (let [[point1 point2] data
            [x1 y1] point1
            [x2 y2] point2
            x-range (range x1 (+ x2 step-size) step-size)]
           (map (fn [x]
                    (let [factor (/ (- x x1) (- x2 x1))]
                         [(double x) (+ y1 (* factor (- y2 y1)))]))
                x-range)))

```
Выполняет линейную интерполяцию для заданной точки x на основе двух известных точек.
### Интерполяция Лагранжа

```clojure
(defn lagrange [data x]
      (let [n (count data)]
           (reduce
             (fn [acc i]
                 (let [[xi yi] (nth data i)
                       term (reduce (fn [prod j]
                                        (if (not= i j)
                                          (let [[xj _] (nth data j)]
                                               (* prod (/ (- x xj) (- xi xj))))
                                          prod))
                                    1
                                    (range n))]
                      (+ acc (* term yi))))
             0
             (range n))))

(defn interpolate-lagrange [data step start end]
      (let [x-range (range start (+ end step) step)]
           (map #(vector % (lagrange data %)) x-range)))
```

## Ввод/вывод программы

--- 
Пример вычислений для функции sin(x):
В качестве параметров на старте были переданы: `-s 1` - шаг = 1, `-м both` - интерполяция будет проходить двумя методами `-w 4` - размер окна для интерполяционного многочлена Лагранжа
```bash
-> % clojure -M -m interpolation.core -s 1 -m both -w 4
Введите данные в формате X Y
0 0
1.571 1
Линейная интерполяция: от 0.0 до 2.0
0,00    1,00    2,00
0,00    0,64    1,27

3.142 0
Линейная интерполяция: от 1.571 до 3.5709999999999997
1,57    2,57    3,57
1,00    0,36    -0,27

4.712 -1
Линейная интерполяция: от 3.142 до 5.1419999999999995
3,14    4,14    5,14
0,00    -0,64   -1,27

Интерполяционный многочлен Лагранжа: от 0.0 до 4.712
0,00    1,00    2,00    3,00    4,00    5,00
0,00    0,97    0,84    0,12    -0,67   -1,03

12.568 0
Линейная интерполяция: от 4.712 до 12.712
4,71    5,71    6,71    7,71    8,71    9,71    10,71   11,71   12,71
-1,00   -0,87   -0,75   -0,62   -0,49   -0,36   -0,24   -0,11   0,02

Интерполяционный многочлен Лагранжа: от 0.0 до 4.712
0,00    1,00    2,00    3,00    4,00    5,00
0,00    0,97    0,84    0,12    -0,67   -1,03

Интерполяционный многочлен Лагранжа: от 1.571 до 12.568
1,57    2,57    3,57    4,57    5,57    6,57    7,57    8,57    9,57    10,57   11,57   12,57
1,00    0,37    -0,28   -0,91   -1,49   -1,95   -2,26   -2,38   -2,25   -1,84   -1,11   0,00
```

Вывод программы полностью совпадает с выводом в описание лабораторной работы

Так же все точки были помещены в файл input.txt:
```text
0 0.00
1.571 1
3.142 0
4.712 -1
12.568 0
```
И программа была запущена с поданными на ввод точками из этого фала, с помощью команды cat:

```bash
-> % cat input.txt | clojure -M -m interpolation.core -s 1 -w 3 -m lagrange 
Введите данные в формате X Y
Интерполяционный многочлен Лагранжа: от 0.0 до 3.142
0,00    1,00    2,00    3,00    4,00
0,00    0,87    0,93    0,17    -1,39

Интерполяционный многочлен Лагранжа: от 0.0 до 3.142
0,00    1,00    2,00    3,00    4,00
0,00    0,87    0,93    0,17    -1,39

Интерполяционный многочлен Лагранжа: от 1.571 до 4.712
1,57    2,57    3,57    4,57    5,57
1,00    0,36    -0,27   -0,91   -1,55

Интерполяционный многочлен Лагранжа: от 0.0 до 3.142
0,00    1,00    2,00    3,00    4,00
0,00    0,87    0,93    0,17    -1,39

Интерполяционный многочлен Лагранжа: от 1.571 до 4.712
1,57    2,57    3,57    4,57    5,57
1,00    0,36    -0,27   -0,91   -1,55

Интерполяционный многочлен Лагранжа: от 3.142 до 12.568
3,14    4,14    5,14    6,14    7,14    8,14    9,14    10,14   11,14   12,14   13,14
0,00    -0,68   -1,20   -1,56   -1,76   -1,79   -1,67   -1,38   -0,92   -0,31   0,47

Завершение.

```
## Вывод

---

В ходе выполнения лабораторной работы было реализовано приложение для выполнения интерполяции в режиме потоковой обработки данных.
Мной были освоены принципы потоковой обработки данных, работы с командной строкой и вводом/выводом.
Также я реализовал алгоритмы интерполяции на функциональном языке программирования
